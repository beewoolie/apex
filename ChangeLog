2006-10-23  Marc Singer  <elf@zealous.synapse.com>

	* src/arch-arm/entry/mmu-alloc.c (alloc_uncached_top_retain):
	Function returns a block of memory from the top of scanned RAM.
	It also removes the memory from the pool passed to the kernel.

	* src/drivers-lh/drv-clcdc.c (clcdc_init): New configuration
	option to allocate the frame buffer from the top of memory and
	remove it from the pool given the kernel.  It also prevents the
	LCD display from being shut down when the loader passes control to
	the boot or go application.

2006-10-18  Marc Singer  <elf@zealous.synapse.com>

	* Makefile: v1.4.7

	* src/mach-lh7a40x/preinitialization-companion.c:
	Preinitialization support to work-around limitation in Sharp Boot
	ROM.  The ROM only loads 512 bytes from modern NAND parts.  We
	need to pull more of this down in order to properly initialize the
	system and copy the loader to SDRAM.

	* src/drivers/drv-nand.c: Genericized NAND driver.

	* src/drivers-lh/drv-clcdc.c: New panels.  Reorganized the panel
	setup code to better conform to standard nomenclature.

	* src/drivers/drv-dm9000.c: Support for more than one DM9000
	chip.  It can write to both mac address roms as well.
	
2006-08-18    <elf@scarlet.buici.com>

	* src/drivers/drv-fis.c (compare_skips): Fixed the comparison
	function.  The sign sense was wrong and it sorted to the wrong
	order.

2006-08-12    <elf@scarlet.buici.com>

	* Makefile (SUBLEVEL): v1.4.3

	* src/drivers/drv-fis.c (fis_report): Added skips to the report.

	* debian/rules: Removed headerization so that slugimage can be
	responsible for it. 

	* src/drivers/drv-fis.c: Added skip descriptor handling.  This
	means that partitions may include 'skips' where some data
	physically located in the partition is ignored when performing IO
	on the partition.  This feature was added for the slug with a dumb
	version of Redboot that ignores the partition table when looking
	for the data it must copy to SDRAM.
 
	* src/apex/cmd-fill.c (cmd_fill): Removed unwanted printf.

	* src/lib/sort.c (sort): Check for degenerate cases of sorting 0
	or 1 element.

	* debian/*: Fixed the control file and and changelog to properly
	reflect this release.

2006-07-30  Marc Singer  <elf@buici.com>

	* Makefile (SUBLEVEL): Rolling revision in preparation for release
	of the BSP. apex-1.4.2

	* src/mach-lh7952x/env.c: Moved all lh7952x's to use the
	amba-pl011 serial driver in the kernel.

2006-07-29  Marc Singer  <elf@buici.com>

	* src/drivers-lh/drv-clcdc.c (clcdc_release): Revised the order of
	the clcdc driver release so it works on the lh79520 which will
	disable the controller clock.

	* src/drivers/drv-cf.c (ready_wait): Recoded ready_wait to use the
	attribute pin replacement register.  This doesn't really have an
	impact on performance, but it does require that the driver is
	properly configured in the drv_cf.h header.

2006-07-27  Marc Singer  <elf@buici.com>

	* src/drivers/drv-cf.c (cf_identify): Fixed attribute reading for
	some cards that return the value in the high and low bytes.
	Attribute memory is really only byte addressable.  This fixes a
	problem with recognizing some brands of CF cards.

2006-07-25  Marc Singer  <elf@buici.com>

	* usr/printenv.cc: Rewritten printenv program to support the new
	environment memory format.
 
	* README_environment: New README about the environment.

	* Makefile: Removed envmagic.h and it's computation.  The new
	environment is free-standing and removal of envmagic makes the
	build much quicker.
 
2006-07-25  Marc Singer  <elf@cerise.buici.com>

	* src/lib/env.c (_env_locate): New environment implementation is
	self-contained for both reading and writing.

2006-07-25    <elf@scarlet.buici.com>

	* src/mach-ixp42x/debian-nslu2-arm_config: Moved the start of the
	kernel and ramdisk regions to skip the 16 byte sercomm header.

	* include/atag.h: Fixed atag section macros.

2006-07-23    <elf@scarlet.buici.com>

	* src/mach-ixp42x/cpuinfo.c (cpuinfo_report): Alignment change to
	the cpuinfo function.

	* include/driver.h: Added query function to the driver jump table.

	* src/drivers/drv-nor-cfi.c (nor_query): New query function allows
	a driver to return information about the device.  NOR flash is the
	only implementer because it's the one that needs this most.  
	(copy_from): Implementation of a byte swapping copy routine for
	the sake of BE/LE conversion.

	* src/drivers/drv-fis.c (prescan_directory): New directory prescan
	detemines if the flash directory has a different endian-ness from
	APEX.
	(map_region): New function to map the directory entry to a
	region.  Now, the region use the underlying flash driver.

	* src/apex/cmd-copy.c (cmd_copy): Added -s option to copy for byte
	swapping data where the source is a different ending from APEX.

2006-07-22    <elf@scarlet.buici.com>

	* src/drivers/drv-mem.c (memory_read): Checks the width field and
	performs IO accordingly.

	* src/apex/cmd-help.c: Revised command line help. 

	* include/driver.h: New descriptor field specifies the IO width.
	This allows, in particular, the memory driver to tailor the I/O to
	a specific width.  Some regions must be read as words (CPU
	registers), others as bytes (CF).

	* src/apex/cmd-dump.c (cmd_dump): Here, and elsewhere, added
	alignment attributes so that byte arrays on the stack are word
	aligned.  I had thought that this was a given but the 4.x
	compilers no longer make this true.
   
	* src/drivers/drv-nor-cfi.c (nor_report): Code to detect endian
	mismatch.  A debugging aid for nslu2.

2006-07-21  Marc Singer  <elf@buici.com>

	* Many: Modified several source files to cope with GCC 4.1.  Found
	a bug detected by GCC's null statement detection.  Mostly warning
	fixes dues to signed/unsigned coercion.

2006-07-20  Marc Singer  <elf@buici.com>

	* Makefile: Release 1.3.30.  Debianized.  New FIS driver.

	* src/apex/command.c (expand_variables): Using new lookup function
	to resolve variable/macro references in command expansion.

	* src/lib/lookup.c: New lookup function to handle checks to
	aliases as well as environment without explicitly including
	ifdefs.

	* src/drivers/drv-jffs2.c (block_driver): Replacing static block
	driver string with a function that looks at aliases and the
	environment.
	
	* src/drivers/drv-fat.c (block_driver): Replacing static block
	driver string with a function that looks at aliases and the
	environment.

	* src/drivers/drv-ext2.c (block_driver): Replacing static block
	driver string with a function that looks at aliases and the
	environment.

	* src/drivers/drv-fis.c: New FIS partition driver.

2006-07-18  Marc Singer  <elf@buici.com>

	* src/arch-arm/entry/reset.c: Added code to support forcing the
	CPU into LITTLEENDIAN mode.  This is necessary for running the
	NSLU2 is LE mode for Debian without replacing the Redboot loader.

2006-07-14  Marc Singer  <elf@buici.com>

	* Makefile: added logic to the build to archive prebuilt binaries
	for each configuration.

2006-07-11  Marc Singer  <elf@buici.com>

	* src/arch-arm/entry/reset.c: Fix for register being clobbered in
	apex_relocate() and messing with PUTC_LL().

2006-07-10  Marc Singer  <elf@buici.com>

	* src/apex/cmd-help.c (cmd_help): Added option to suppress the
	short help descriptions.  It saves a little bit on memory.

	* src/arch-arm/entry/apex.lds.S: Optimized the RAM memory
	footprint, especially in the xbss section.  Added stack_size
	configuration parameter. 

	* src/apex/cmd-boot.c (cmd_boot): Boot address may not come from
	the environment.
	(atag_commandline): Simplified the command line from environment
	code such that there is no code to read from environment when
	there is no environment.

2006-06-02  Marc Singer  <elf@buici.com>

	* Makefile: Release 1.3.28.  Added dm9000 mac address programming.

2006-06-02  Marc Singer  <elf@cerise.buici.com>

	* Makefile: Release 1.3.27.  Version for companion as well.

2006-06-01  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/relocate-companion.c: Fixed the section of the
	relocation function.  Added console feedback for the bootstrap.

	* src/drivers-lh/drv-mmc.c: Added proper configuration checks for
	the companion relocation.

	* Many changes to the environment handling so that the environment
	is present, and usable, even if the commands to manipulate it are
	not.

	* src/apex/cmd-env.c: Fixed a stupid error in the environment
	command code that required the setenv command in order to use the
	printenv command.

2006-05-29  Marc Singer  <elf@buici.com>

	* src/drivers/drv-ext2.c (ext2_info): Fixed the way that
	partitions are detected so that changing partitions will properly
	flush cached information about the filesystem.

2006-05-28  Marc Singer  <elf@buici.com>

	* Makefile (SUBLEVEL): Rolled to 1.3.25 for the MMC driver fixes.

	* src/arch-arm/entry/apex.lds.S: The bootstrap data location is
	properly calculated.

	* src/drivers-lh/drv-mmc.c: MMC driver can read multiple blocks.
	Well, two to be precise, but at least we know it works.  The
	status returned from wait_for_status it more than 16 bits because
	of the timeout.  All of the reference to status are widened to
	int's to make this easier.
	(execute_command): Default wait_for status is not better tuned to
	the command being executed.  The driver gets a nice, smooth data
	stream from the card.

2006-05-27  Marc Singer  <elf@cerise.buici.com>

	* Makefile (SUBLEVEL): New sub-level for the companion changes.
	This will roll to a new patchlevel when we get the drivers going
	for sure.

	* src/mach-lh7a40x/relocate-companion.c: relocate-apex ()
	implementation for the synapse companion.

	* src/arch-arm/Kconfig: Added more configuration options for
	compiler optimizations.

	* src/drivers-lh/drv-i2c.c: i2c driver for reading/writing
	EEPROM.

	* src/drivers-lh/drv-mmc.c: Mmc driver, SD capable, bootstrap
	capable

	* include/mmc.h: Factored out the mmc header for the sake of
	relocation from SD/MMC.

	* src/arch-arm/entry/apex.lds.S: Special section for bootstrap
	stack and bootstrap data.

	* include/apex.h: Aide functions for mdelay and msleep. 

2006-05-04  Marc Singer  <elf@buici.com>

	* src/drivers-lh/drv-clcdc.c: Added support for BGR color format
	in the frame buffer.  This is really for the benefit of testing,
	but may also be important when we support a splash screen being
	visible through the kernel boot process.

2006-04-03  Marc Singer  <elf@buici.com>

	* Makefile: 1.3.23
	* Additions to the kconfig directory so that make menuconfig
	works again. 
	
2006-04-01  Marc Singer  <elf@buici.com>

	* Makefile: 1.3.22

	* src/mach-lh7952x/drv-emac.c (cmd_emac): Moved static structure
	to .rodata.

	* src/drivers/drv-smc91x.c (cmd_eth): Moved static structure to
	.rodata.

	* src/apex/command.c (expand_variables): Allowing '\' escape of
	'$' to prevent expansion of variables for the sake of storing them
	in other environment strings, e.g. startup.

	* include/attributes.h: Grooming.

	* src/apex/console.c: Added (optional) command
	editing...finally...no kidding.

2006-03-31  Marc Singer  <elf@buici.com>

	* src/apex/console.c (read_command): Added (optional) support for
	ANSI key sequences.

	* src/apex/command-history.c: Added (optional) command history
	recall.

2006-03-30  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-emac.c (emac_release): added a release
	function to the emac driver.  We were having problems with
	spurrious corruption of kernel memory and it looks like the
	problem was that the emac was in an indeterminate state as it was
	being initialized.

2006-03-23  Marc Singer  <elf@buici.com>

	* src/apex/cmd-version.c (cmd_version): Fixed the presentation of
	the apex region for the case when the length is greater than four
	hex digits.

	* src/apex/console.c (read_command): Configuration option allows
	DEL to be interpreted as BS.

	* Makefile: 1.3.21

	* usr/printenv.cc (main): Application that reads APEX environment
	from user-land.

	* src/apex/env.c: added environment link support so that user-land
	applications can read the APEX environment.

2006-03-22  Marc Singer  <elf@buici.com>

	* src/drivers-lh/drv-clcdc.c (VSW): Fixed error in the VSW macro.

	* src/drivers/drv-ext2.c (ext2_find_inode): Fixed the computation
	of the first block where the group descriptors are found.  This
	allows APEX to read cards with block sizes other than 1K.

2006-03-16  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/freq: Perl script that aids in finding clock
	frequency dividers.

	* src/mach-lh7a40x/Kconfig: Added more overclocking frequencies to
	the lh7a40x configuration.

	* Brought Kconfig sources up to date.

2006-03-15  Marc Singer  <elf@buici.com>

	* Makefile: 1.3.20

	* src/mach-lh7a40x/initialize.c: Adjusted the SMC controller
	timing setup to be sensitive to HCLK as configured.

	* src/mach-lh7a40x/lh7a40x.h: Kconfig selectable operating
	frequencies.

	* Adding support for new architecture, s3c2410, and new machine
	m7200.

2006-03-02  Marc Singer  <elf@buici.com>

	* Makefile: 1.3.19

	* src/mach-lh7952x/lh79524.h (RCPC_CPUCLKPRE_V): Added support for
	faster clocking of the LH79524.  It isn't, yet, compatible with
	the Linux kernel.  However, this may help someone who is looking
	for a little more speed.

	* src/mach-lh7a40x/initialize.c (target_init): Added support for
	the LPD7A404-10, PN 80000258, USB_PWR_EN.  The sense of this line
	changed between the -10 and the -11 releases of the LPD7A404
	CardEngine.

2006-02-23  Marc Singer  <elf@buici.com>

	* Makefile: 1.3.18

	* src/mach-lh7952x/init-lpd79524.c: Tighetened the CF region
	timing as is done for the other targets.

	* src/mach-lh7952x/init-lpd79520.c: Adjusted to the CompactFlash
	region timing to meet the CF spec.

	* src/mach-lh7a40x/initialize.c (SMC_BCR6_V): Tightened the CF
	region timing to be closer to the specified minimums.  The
	original WST1 delay was 320ns which may interfere with the LCD
	controller FIFO.

2006-02-22  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/initialize.c (SMC_BCR1_V): Tightened the
	IOBARRIER region timing to see if we can get access to NOR flash
	without causing display flicker.

2006-02-17  Marc Singer  <elf@buici.com>

	* src/lib/zlib-heap.c (CB_HEAP): Increased the size of the heap so
	I can decompress very large PNG images.

	* Makefile:  1.3.17

	* src/drivers-lh/drv-clcdc.c: New timings for the 6.4" display.
	The vertical front porch is one less than the spec.

	* src/mach-lh7a40x/initialize.c (SDRAM_RAS): Relaxed memory
	timings on the lh7a40x's.  This seems to eliminate display
	glitching as long as we don't use the CF.

2006-02-07  Marc Singer  <elf@buici.com>

	* Makefile: 1.3.16

	* src/mach-lh7952x/init-lpd79524.c: Reworked SDRAM initialization.
	Now, we can init the CPU with a 16 bit SDRAM bus even if the SDRAM
	chips are configured in a 32 bit bus.  Half of the SDRAM will idle
	in this configuration, but we can test CPU performance with the 16
	bit bus.

	* src/mach-lh7a40x/cmd-cp15test.c: Added a cp15 test register
	manipulation function.

2006-02-06  Marc Singer  <elf@buici.com>

	* lh7a404_config: Setting default memory mode to SROM_LL.

2006-01-20  Marc Singer  <elf@buici.com>

	* src/lib/pngr.c (read_pngr_plte): When found, a palette is read
	from the PNG file and stored for the decoder.

	* src/drivers-lh/drv-clcdc.c (cmd_splash): Added support for
	palettized images, but only at 8 bits per pel.  Other pel sizes
	require unpacking of the image data.

2006-01-13  Marc Singer  <elf@buici.com>

	* src/mach-ixp42x/openslug_config: Openslug 3.1 no longer puts the
	kernel in the jffs2 partition.  We default to reading the kernel
	from flash.

	* src/arch-arm/entry/mmu.c (mmu_release): In order to support
	XScale MMU (and caches) we need to customize the MMU disabling
	code to cope with a different method of cleaning the data cache.
	This is done for the sake of faster loading of a JFFS2 filesystem
	image.  The kernel is stored in a JFFS2 filesystem in flash for
	compactness.  The faster we can read this data, the better.  Also,
	reads from flash of ramdisk images benefits from caching.

2005-12-27  Marc Singer  <elf@buici.com>

	* src/arch-arm/lib/relocate.c (relocate_apex): Improved the scarce
	register version of the system copy routine.  It's now using the
	same form as the fastest version.

	* src/mach-lh7a40x/cmd-reset.c (cmd_reset): Added reset command
	for the lh7a40x targets.  It used the watchdog timer to perform
	the system reset.

	* src/arch-arm/entry/entry.c (setup_c): Added code for clearing
	stacks to a known value.

	* src/mach-lh7952x/exception_vectors.c: The exception handling
	code works.  APEX can use interrupts.

	* src/arch-arm/lib/relocate.c (relocate_apex) :recoded
	relocation test to reduce the number of registers and to update
	the syntax for __asm constraints.  This code was substantially
	modified to reflect some minor optimizations.

	* src/mach-lh7952x/relocate-nand.c (relocate_apex): recoded
	relocation test to reduce the number of registers and to update
	the syntax for __asm constraints.

	* src/mach-lh7a40x/initialize.c (usleep): recoded timer to
	update the syntax for __asm constraints.

	* src/mach-lh7952x/init-kev79524.c (usleep): recoded timer to
	update the syntax for __asm constraints.

	* src/mach-lh7952x/init-lpd79520.c (usleep): recoded timer to
	update the syntax for __asm constraints.

	* src/mach-lh7952x/init-lnode80.c (usleep): recoded timer to
	update the syntax for __asm constraints.

	* src/mach-lh7952x/init-lpd79524.c (usleep): recoded timer to
	update the syntax for __asm constraints.

2005-12-22  Marc Singer  <elf@buici.com>

	* src/lib/pngr.c (open_pngr): Function modified to allow for
	reading from TFTP where we don't know the length of the stream
	a priori.

	* src/net/tftp.c (tftp_seek): Rudimentary seek function
	implemented for the sake of splash decoding.  We needed to be able
	to seek over the CRC (or unused portion of any chunk) in order to
	decode PNG images over the network.

	* src/lib/zlib-heap.c: Makde the zlib heap larger since the
	decompressor was choking on the decode of a large splash image.
	Also moved the memory to xbss.  We're still using a stupid null
	free heap which has to be as large as all of the allocated memory.
	RAM is cheap, at the moment.  Perhaps we should switch to the
	kernel's zlib decompressor instead of the uboot version.

	* src/drivers-lh/drv-clcdc.c: Common LCD driver for Sharp LH
	parts.

	* src/arch-arm/entry/mmu-alloc.c (alloc_uncached): Function to
	allocate memory that won't be cached even when the MMU is enabled.

2005-12-19  Marc Singer  <elf@buici.com>

	* src/arch-arm/entry/mmu.c: Service to enable and disable the MMU.
	This makes the boot loader execute much faster than without.

	* src/mach-lh7952x/serial.c (lh7952x_serial_release): Added a
	release function so that serial data in the FIFO is flushed.

	* src/mach-lh7a40x/serial.c (lh7a40x_serial_release): Added a
	release function so that serial data in the FIFO is flushed.

2005-12-16  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/lh7a40x.h: Added an overclocking mode.

	* src/mach-lh7a40x/initialize.c: Added more explicit macros to
	handle bus clocking modes.  Also, we've switched to the
	synchronous bus mode as the default.

	* src/mach-lh7a40x/lh7a40x.h: Added more explicit macros to handle
	bus clocking modes.

	* src/drivers/drv-mem.c: Added memlimit command so that we can
	constrain the amount of memory that the Linux kernel sees.  It's a
	handy debug feature.

2005-11-18  Marc Singer  <elf@buici.com>

	* src/drivers/drv-nor-cfi.c: Added option to inhibit the NOR CFI
	buffered write code, for lnode80.

	* src/mach-lh7952x/Kconfig: Added lnode80, patch from Dave Anders.

2005-11-07  Marc Singer  <elf@buici.com>

	* Makefile: Rolling release for 79525 and for a fix to the
	emac79524 driver.

2005-10-08  Marc Singer  <elf@buici.com>

	* src/net/ethernet.c (arp_terminate): Added a check for ^C in the
	ARP termination function.

	* src/net/tftp.c (tftp_open): Reorganized the tftp open sequence
	in case ARP for the TFTP server has yet to be achieved.  This was
	a crash bug.

2005-10-07  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/Kconfig: Start of changes for the kev79525.

	* src/arch-arm/entry/apex.lds.S: Fixed the drv-mem probe code to
	be reliable and safe.

2005-09-30  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/initialize.c: Slowed the timing down for the
	IOBARRIER.  Now, we're using the slowest timing because that's all
	that seems to work.

	* src/arch-arm/entry/sdramboot.c (sdramboot_report): Unified
	support for reporting when APEX is booted from SDRAM.  While only
	informational, this will help explain to new users the difference
	between booting from flash or SRAM and from SDRAM.

2005-09-29  Marc Singer  <elf@buici.com>

	* src/apex/env.c: Updated autoboot cancellation message to be more
	correct.  Only ^C cancels now.

2005-09-28  Marc Singer  <elf@cerise.buici.com>

	* src/arch-arm/Makefile: architecture and tune features.  This
	fixes a build problem with native compilers.

	* src/arch-arm/Kconfig: New configuration features to select the
	right architecture.  Lack of this was the source of a nasty build
	error having to do with the fact that the default CPU type on ARM
	doesn't support the half-word load.

2005-09-27  Marc Singer  <elf@cerise.buici.com>

	* src/arch-arm/entry/apex.lds.S: Enlarged the stacks.  We were
	crashing from a stack overflow in the jffs2 decompression path.

	* src/lib/zlib.c: Changes so that we can use the debug option.

	* src/drivers/drv-jffs2.c (jffs2_load_cache): Fixed bug in jffs2
	filesystem cache.  Cancelled cache operation which was restarted
	would create duplicate entries in the cache.

2005-09-18  Marc Singer  <elf@buici.com>

	* include/attributes.h (__xbss): New attribute macro for easy xbss
	spec.

2005-09-15  Marc Singer  <elf@buici.com>

	* src/lib/env.c (_env_check_magic): Modified the environment check
	before writing to look for a large block of 0xff's before
	declaring the area blank.

2005-09-02  Marc Singer  <elf@buici.com>

	* src/arch-arm/entry/apex.lds.S: Needed to set the xbss section to
	NOLOAD so that the loader image wouldn't bloat with BSS areas

2005-08-22  Marc Singer  <elf@buici.com>

	* src/arch-arm/entry/apex.lds.S: Reorganized the BSS sections.
	Needed to put the BSS outside of the protected region so that the
	memory scan finds all of memory correctly.  This change also
	prevents some of the BSS memory from being zeroed.

2005-08-15  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/initialize.c (target_init): Modified the target
	init for lpd7a404 so that the SMC91x controller works properly on
	the latest lpd7a404 CardEngines; PCN-285 2005.5.4.

2005-08-11  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/lpd7a40x.h (CPLD_CONTROL_WLPEN): Changed
	constant name to match that used by the driver and the LPD79520.

	* src/mach-lh7a40x/timer.c (timer_delta): The interval timer was
	wrong, too.

	* src/mach-lh7a40x/initialize.c: The usleep timer setup was wrong.
	Don't know how this ever worked.  ;-) Had to move it to timer2 so
	that it didn't conflict with the interval timer.

2005-08-10  Marc Singer  <elf@buici.com>

	* src/drivers/drv-mem.c (memory_report): Groomed the memory report
	to eliminate first blank line.

	* src/apex/command.c (exec_monitor): Removed leading whitespace in
	startup command reports.

2005-08-08  Marc Singer  <elf@buici.com>

	* src/apex/cmd-copy.c (cmd_copy): Detecting copy errors and
	returning appropriate error code.

	* src/apex/command.c (exec_monitor): Fixed parser for startup
	command so that semicolon no longer needed at the end of the
	command.  Fixed a bug in the routine that writes to address zero
	on startup.

	* src/apex/console.c (console_poll): Improved methods for
	detecting user break condition.  Injected a meta-driver between
	the serial driver and the functions that communicate with the
	user.

2005-08-03  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/ads7843.c: ads7843 test command.

2005-08-01  Marc Singer  <elf@buici.com>

	* src/net/ipconfig.c (cmd_ipconfig): IP configuration via RARP or
	manual configuration.

	* src/mach-lh7952x/drv-emac.c (cmd_emac): Some grooming of the
	diagnostic outputs.

	* src/net/tftp.c (ping_terminate): Fixed abort of tftp by
	keystroke.

	* src/mach-lh7952x/drv-emac.c (eth_read): Check for buffer looping
	on read.  This is untested.

2005-07-29  Marc Singer  <elf@buici.com>

	* src/net/tftp.c: fixed the tftp state machine and tested that
	retries work correctly.   it seems to be stable and reliable in
	light of packet losses.

	* src/apex/cmd-copy.c (cmd_copy): Fixed a long-standing bug in the
	copy command where the din descriptor was being opened twice.

2005-07-28  Marc Singer  <elf@buici.com>

	* src/drivers/drv-smc91x.c: Implemented smc91x driver which is
	available to both the lpd79520 and the lpd7a40x boards.

	* src/mach-lh7952x/init-lpd79520.c: Fixed the initialization of
	the memory region where CF is found.  CF driver working again.

2005-07-11  Marc Singer  <elf@buici.com>

	* src/apex/cmd-dump.c (cmd_dump): Added dump display width to make
	it easier to read registers and machine code.

2005-07-07  Marc Singer  <elf@buici.com>

	* src/net/rarp.c (cmd_rarp): RARP implemented.

	* src/apex/cmd-help.c (cmd_help): Changed the way that commands
	are sorted such that there is no change to the R/O portion of the
	file.  Now, sorting is done only when displaying the help text.

	* src/mach-lh7952x/drv-emac.c (eth_open): Basis of ethernet driver
	is working.

	* src/arch-arm/entry/apex.lds.S: Neglected alignment caused a
	crash when the data segment wasn't aligned.  The service data was
	misaligned such that the service start addresses were wrong.

2005-07-06  Marc Singer  <elf@buici.com>

	* src/apex/cmd-dump.c (cmd_dump): Added more mode to the dump
	command.

	* src/apex/command.c (expand_variables): Alias and environment
	expansion in the command line.  This will make some people's lives
	easier.

2005-06-15  Marc Singer  <elf@buici.com>

	* src/apex/command.c (exec_monitor): Adding configuration option
	to sort commands for the sake of better help.

	* src/apex/cmd-xreceive.c: Revising help text.

2005-06-14  Marc Singer  <elf@buici.com>

	* src/drivers/driver.c (parse_descriptor): Fixed the driver parser
	dependency on the filesystem drivers.

	* src/drivers/drv-fat.c (fat_read): Region length calc, again.

	* src/drivers/drv-ext2.c (ext2_read): Fixed the region length
	calcs.

	* src/drivers/drv-jffs2.c (jffs2_open): Fixed some of the region
	length calcs.

2005-06-13  Marc Singer  <elf@buici.com>

	* src/drivers/drv-jffs2.c (jffs2_path_to_inode): Needed to
	invalidate the cached block after chasing links.
	(find_cached_inode): Enhanced find_cached_inode() to accept an
	offset within the file.  This may improve the performance of
	reading since it doesn't have to scan the inode list from the top
	every time.  Moreover, the algorithm of the find_cached_inode
	function is more efficient for larget files.
	(jffs2_load_cache): Changed the logic for handling reversed
	markers.  The previous code would prematurely terminate if a
	reversed marker was found among the filesystem detritus.
	(jffs2_load_cache): Added a CRC check for inodes.
	(jffs2_path_to_inode): Added a CRC check for filenames.

2005-06-12  Marc Singer  <elf@buici.com>

	* src/apex/cmd-info.c: New command to query information about a
	region from a driver.  It's used by the jffs2 driver to show the
	contents of a directory.  Other filesystems ought to follow suit.

	* src/drivers/drv-jffs2.c: New jffs2 reading filesystem driver.

2005-05-15  Marc Singer  <elf@buici.com>

	* src/mach-ixp42x/pci.c (pci_init): Added IRQ setup for all of the
	PCI interrupt pins.

2005-05-15  Marc Singer  <elf@cerise.buici.com>

	* src/lib/spinner.c (spinner_clear): clearing LED spinner when the
	user enters a command prompt.

	* src/mach-ixp42x/pci.c (pci_init): Proper PCI initialization
	brings USB and ethernet online.  Woot.

	* src/mach-ixp42x/nslu2.h: GPIO constants and macros for init.

	* src/mach-ixp42x/ixp42x.h: GPIO constants and macros for init.

	* src/mach-ixp42x/initialize.c (target_init): Addition of dead
	code to initialize GPIO for the Intel dev board.

	* src/mach-ixp42x/serial.c (ixp42x_serial_init): Enabled the
	serial FIFO.

2005-05-04  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-emac.c: Diagnostic code can be enabled from
	the configuration.

	* src/apex/cmd-version.c (cmd_version): Display the length of apex
	in bytes as well as hex.

2005-04-14  Marc Singer  <elf@buici.com>

	* src/arch-arm/Kconfig: New option to let the user configure a
	default commandline to override the target's default.

	* src/mach-ixp42x/initialize.c (target_init): Added neglected EXP
	controller initializations for the nslu2.

2005-04-13  Marc Singer  <elf@buici.com>

	* src/drivers/drv-ext2.c: Added configuration option to set the
	block device for both (fat & ext2) filesystem drivers.

	* src/apex/env.c: Fixed errors in the autoboot macros left over
	from the transition to Kconfig.

2005-04-08  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-emac.c (emac_init): Fixed detection of the
	PHY.  Needed to setup MUX to get the PHY to enable.

	* src/mach-ixp42x/coprocessor.h (COPROCESSOR_WAIT\): New headers
	to define an instruction sequence to let the MMU/coprocessor catch
	up when there are changes to the setup.

	* src/arch-arm/entry/entry.c (__section): New options for
	disabling MMU at startup.

	* Makefile (every): Fixed every target for the sake of adding new
	configuration options.

2005-04-07  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/Makefile (obj-$(CONFIG_DRIVER_EMAC_LH79524)):
	Same as below.

	* src/mach-lh7952x/drv-emac.c: Corrected configuration references
	for the new configurator.  Macros were wrong for EMAC.

2005-03-22  Marc Singer  <elf@buici.com>

	* src/apex/env.c (_s): Fixed references to CONFIG_ macros that may
	already be quoted.

2005-03-20  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/initialize.c (__section): initializing the SMC
	control so that flash works correctly.

	* Makefile (SUBLEVEL): Fixed the reset of the config hooks so that
	the build is now optimal with respect to the configuration.

	* Fixed menuconfig.  Still, I've never been able to edit strings,
	hex's, or int's in menuconfig. It's there for the folks who want it.

	* Makefile (SUBLEVEL): Rolling revision for integration of new
	configuration support.  This is a big deal because it means that
	configurations are easier to build and more robust.

	* scripts/configtoh: Stripping the quotes from config options.
	We're using the kernel configurator, so we have less control over
	the user's actions.  This may prove to be overly zealous in
	situations where the configuration option needs quotes.
	...Now it is really fixed.  Needed it and there was no way around it.

2005-03-17  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/cpuinfo.c (cpuinfo_report): Fixed the CPUID
	reporting for the lh7a404.

	* src/mach-lh7a40x/initialize.c: Added hack to the lpd7a40x
	initialization to enable PCMCIA.  May be a work-around for a NOR
	flash problem.

	* src/drivers/drv-nor-cfi.c (nor_read): Eliminated (most)
	references to nor chip length except when necessary.

2005-03-16  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/timer-lh79520.c (lh79520_timer_init): Fixed the
	initialization of the boot loader timer.

	* src/mach-lh7952x/lpd79520_config (CONFIG_NOR_BANK0_START): Fixed
	the starting address of the NOR flash so that the REMAP register
	doesn't make a difference.

	* src/apex/cmd-boot.c: Making sure that the ATAG pointer is valid.

2005-03-15  Marc Singer  <elf@buici.com>

	* src/arch-arm/entry/apex.lds.S: Added new START identifier for
	the sake of the memory scan function.

	* src/drivers/drv-mem.c (memory_scan): The memory scan function
	needed to make sure not to write to BSS.  It now avoids the entire
	memory image of APEX.

2005-03-10  Marc Singer  <elf@buici.com>

	* src/mach-lh7a40x/initialize.c: SDRAM initialization was
	completely broken since 1.1.0.  It works again.

	* src/drivers/drv-cf.c: Moved Compact Flash code to live among
	generic drivers.  Implemented CF for the 79520's.  Wrote code for
	the 7a40x's, but it isn't working.

	* src/drivers/drv-ext2.c (ext2_path_to_inode): Fixed dumb error in
	the symlink traversal code.

	* src/drivers/drv-nor-cfi.c: Improved TALK for troubleshooting
	flash.

2005-03-09  Marc Singer  <elf@buici.com>

	* src/drivers/drv-nor-cfi.c: Moved the cfi driver into the generic
	driver directory.  There is a machine specific header to handle
	the target controlled constants.

	* Makefile (ENV_CROSS_COMPILE): Fixed the selection of the cross
	compiler so that the environment will override the configured
	value.

2005-03-07  Marc Singer  <elf@buici.com>

	* src/drivers/drv-ext2.c: ext2 driver is working.  It supports
	paths and following symlinks.

	* scripts/envmagic: Grooming.  Properly fixed.

	* src/mach-ixp42x/serial.c (ixp42x_serial_write): Waiting for all
	data to write before returning.

	* src/mach-ixp42x/cmd-reset.c (cmd_reset): Resetting services
	before reset so that the nor flash has a chance to enter
	array-read mode.

	* src/mach-lh7952x/cmd-reset.c (cmd_reset): Resetting services
	before reset so that the nor flash has a chance to enter
	array-read mode.

	* src/mach-lh7952x/drv-nor-cfi.c (nor_release): Release function
	added so that cmd-reset will reliably perform.

	* src/drivers/drv-fat.c (fat_find): Fat filename comparisions are
	not case insensitive without requiring the descriptor parser to
	lower-case the path elements.

2005-03-06  Marc Singer  <elf@buici.com>

	* src/drivers/drv-ext2.c: A rudimentary ext2 driver is
	implemented.  It has not received much testing.

	* src/apex/command.c (call_command): Added strings to error
	reporting when not CONFIG_SMALL and a string has not yet been set.

2005-03-04  Marc Singer  <elf@buici.com>

	* scripts/envmagic: Removed undesirable paths from the find.

2005-03-03  Marc Singer  <elf@buici.com>

	* src/lib/png.c (read_png_row): Decoder working properly with the
	logo and with cc.

	* src/lib/zlib.c: Fixed the zlib declarations s.t. there is no
	initialized, mutable data.

	* src/lib/png.c: Added png interpreter for the sake of splash
	screen images.

	* src/lib/zlib.c: Added zlib decompressor.  Modified code to
	comply with data section standards of APEX.

2005-02-24  Marc Singer  <elf@buici.com>

	* src/mach-ixp42x/initialize.c: detection of the chip size from
	the config parameters.  All fat slugs should be simple settings in
	the config.

2005-02-23  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-emac.c, src/apex/cmd-copy.c: Work-around
	for gcc-2.95 preprocessor bug.

2005-02-22  Marc Singer  <elf@buici.com>

	* src/drivers/drv-fat.c (fat_open): Typo prevented reading from
	any partition other than 1.

	* src/drivers/drv-mem.c (memory_init): Reorganized the
	configuration of SDRAM s.t. it is cleaner in the configuration
	file and controlled by a mach- specific header.  This make it
	easier to make sure the initialization is correct.

2005-02-21  Marc Singer  <elf@buici.com>

	* Makefile (SUBLEVEL): rolled to 1.1.0 for release with
	Milestone2.  Yipee!

	* src/mach-lh7952x/drv-emac.c: Cleanup of the driver.  Better
	control over compile options.  Added help and report features.

2005-02-20  Marc Singer  <elf@buici.com>

	* Makefile Revision in preparation for milestone2 release.

	* src/mach-lh7952x/drv-nor-cfi.c (NOR_1_LENGTH): added logic
	necessary to support the double bank of NOR flash on the LPD79524
	boards.
	(nor_init_chip): Changed initialization to properly cope with two
	banks (or a pair of identical chips).

2005-02-19  Marc Singer  <elf@buici.com>

	* src/arch-arm/lib/lib1funcs.S: Imported this file from kernel in
	order to get general purpose integer divide and modulo functions.

2005-02-18  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/init-lpd79520.c: Fixed SDRAM init to comply
	with Sharp recommendations in their SDRAM application note.
	Thanks to prplague :-).

2005-02-17  Marc Singer  <elf@buici.com>

	* src/arch-arm/lib/relocate.c: Implemented a simpler
	copy loop to help some platforms along.

2005-02-16  Marc Singer  <elf@buici.com>

	* src/mach-ixp42x/nslu2_config (CONFIG_ENV_REGION): Changed the
	environment region for the nslu2 so that it can be written without
	clobbering the second redboot block.

	* src/apex/cmd-copy.c (cmd_copy): Added a -v switch to copy which
	performs a double read of the source and a read after write of the
	destination to make sure the copy is correct.

	* src/mach-ixp42x/initialize.c (__section): Added DEBUG_LL
	support.

	* src/apex/cmd-compare.c (cmd_compare): Added -c switch to compare
	so we can see more than one difference in a block.

2005-02-15  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/serial.c Errors in the UART macros prevented
	serial output on the 79520.

2005-02-14  Marc Singer  <elf@buici.com>

	* Makefile 1.0.25: for good measure

2005-02-12  Marc Singer  <elf@buici.com>

	* Makefile 1.0.24 for debug_ll changes

2005-02-12  Marc Singer  <elf@cerise.buici.com>

	* Makefile: Moved the compiler declarations to the config files.

	* include/debug_ll.h: Added low-level debug support via the serial
	console.

2005-02-11  Marc Singer  <elf@buici.com>

	* src/lib/spinner.c (spinner_step): Smoothed out the spinner.

2005-02-11  Marc Singer  <elf@cerise.buici.com>

	* Makefile 1.0.23 for the nslu2 spinner.

2005-02-11  Marc Singer  <elf@buici.com>

	* src/mach-ixp42x/spinner-nslu2.c (nslu2_spinner): Implemented a
	spinner for the platform.  It uses the LEDs to show progress.

	* Makefile: 1.0.22 for NSLU2 updates.

	* src/mach-ixp42x/nslu2.h: Adding header specific to this target.

	* src/mach-ixp42x/initialize.c (initialize_bootstrap):
	Initializing the GPIO lines. Adding more LED changes.

	* src/mach-ixp42x/nslu2_config (CONFIG_SPINNER): Adding
	configuration options for more.

2005-02-10  Marc Singer  <elf@buici.com>

	* include/attributes.h (__attribute__): Builds with 2.95.3.  Not
	yet tested.

2005-01-26  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/adc.c (cmd_adc): Basic adc code working.

	* src/apex/console-printf.c (printf): Automatic insertion of
	carriage-returns before newlines.

2005-01-21  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-nor-cfi.c (nor_report): Added report
	function to nor driver.

	* src/mach-lh7a40x/drv-nor.c (nor_report): Added report funtion to
	nor driver.

2005-01-13  Marc Singer  <elf@buici.com>

	* src/apex/cmd-version.c (cmd_version): Rewording signon.

	* src/mach-lh7952x/Makefile (obj-$(CONFIG_MACH_LPD79524)): Moved
	adc to 79524 specific build.

	* scripts/configtoh: Fixed the script to properly elide comments.

2005-01-12  Marc Singer  <elf@buici.com>

	* README_config: Editing the documentation.

	* Makefile (include/config.h): Fixed the script that generates the
	configuration file.
	(tidy): New target to remove debris.

2004-12-05  Marc Singer  <elf@buici.com>

	* src/lib/env.c (_env_check_magic): Magic number inserted at the
	start of the environment to protect user from bogus data.

	* src/mach-lh7a40x/drv-nor.c (nor_write): LPD7A40X targets
	completely supported though buffered writes to NOR flash not yet
	implemented.

2004-12-01  Marc Singer  <elf@buici.com>

	* README: New README(s) in preparation to release the source.

2004-11-17  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-nor.c (nor_write): Fixed a buglet in
	buffered writes where the size of the write was incorrect in some
	edge cases.

	* src/mach-lh7952x/drv-cpld-spi.c: Added cpld-spi drivers for
	configuration EEPROM and for the MAC EEPROM.

	* src/mach-lh7952x/drv-emac.c (emac_read_mac): Fixed the EEPROM
	code.
	(cmd_emac): Removed eeprom specifics into another driver.

	* src/lib/dump.c (dump): Correct bug offset to rgb.

2004-11-16  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-emac.c (cmd_emac): Ethernet MAC maintenance
	function as well as interface initialization.

	* src/lib/dump.c (dump): Factored the dump code into a library
	function.

2004-11-15  Marc Singer  <elf@buici.com>

	* src/mach-lh7952x/drv-nor.c (nor_write): Implementing buffered
	write.  It's about 16 times as fast.  Will leave other code for
	the time being since it is smaller by about 260 bytes.

	* First release, 1.0.
